<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joyst Corporation - Admin Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { background: #0a0a0a; color: white; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: #1a0a0a; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #ff4444; text-align: center; }
        .tabs { display: flex; margin-bottom: 20px; background: #1a0a0a; border-radius: 10px; padding: 10px; }
        .tab { padding: 15px 30px; background: #2a0a0a; margin: 0 5px; border-radius: 5px; cursor: pointer; border: 1px solid #ff4444; }
        .tab.active { background: #ff4444; }
        .tab-content { display: none; background: #1a0a0a; padding: 20px; border-radius: 10px; border: 1px solid #ff4444; }
        .tab-content.active { display: block; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; color: #ff4444; }
        input, select, button { padding: 12px; width: 100%; margin: 5px 0; background: #2a0a0a; border: 1px solid #ff4444; color: white; border-radius: 5px; }
        button { background: #ff4444; cursor: pointer; font-weight: bold; }
        button:hover { background: #ff6666; }
        .user-card, .license-card { background: #2a0a0a; padding: 15px; margin: 10px 0; border-radius: 5px; border: 1px solid #ff4444; }
        .message { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #0a2a0a; border: 1px solid #00ff00; }
        .error { background: #2a0a0a; border: 1px solid #ff4444; }
        .api-setup { background: #1a1a2a; padding: 15px; border-radius: 10px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ JOYST CORPORATION</h1>
            <p>Admin Authentication System</p>
        </div>

        <!-- API SETUP SECTION -->
        <div class="api-setup">
            <h3>ðŸ“¡ API Setup (IMPORTANT)</h3>
            <div class="form-group">
                <label>JSONBin.io API Key:</label>
                <input type="text" id="apiKey" placeholder="Get from jsonbin.io">
            </div>
            <div class="form-group">
                <label>Bin ID:</label>
                <input type="text" id="binId" placeholder="Auto-generated">
            </div>
            <button onclick="setupAPI()">Initialize Database</button>
            <div id="apiMessage"></div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('createUser')">Create User</div>
            <div class="tab" onclick="showTab('createLicense')">Create License</div>
            <div class="tab" onclick="showTab('manageUsers')">Manage Users</div>
            <div class="tab" onclick="showTab('manageLicenses')">Manage Licenses</div>
        </div>

        <!-- CREATE USER TAB -->
        <div id="createUser" class="tab-content active">
            <h2>Create New User</h2>
            <div class="form-group">
                <label>Username:</label>
                <input type="text" id="newUsername" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="text" id="newPassword" placeholder="Enter password">
            </div>
            <div class="form-group">
                <label>Subscription Type:</label>
                <select id="userSubscription">
                    <option value="default">Default (30 days)</option>
                    <option value="premium">Premium (30 days)</option>
                    <option value="vip">VIP (30 days)</option>
                </select>
            </div>
            <button onclick="createUser()">Create User</button>
            <div id="userMessage"></div>
        </div>

        <!-- CREATE LICENSE TAB -->
        <div id="createLicense" class="tab-content">
            <h2>Generate License Keys</h2>
            <div class="form-group">
                <label>License Key:</label>
                <input type="text" id="licenseKey" placeholder="JOYST-PREMIUM-XXXXX">
            </div>
            <div class="form-group">
                <label>Subscription Type:</label>
                <select id="licenseSubscription">
                    <option value="default">Default</option>
                    <option value="premium">Premium</option>
                    <option value="vip">VIP</option>
                </select>
            </div>
            <div class="form-group">
                <label>Duration:</label>
                <select id="licenseDuration">
                    <option value="1">1 Day</option>
                    <option value="7">1 Week</option>
                    <option value="30" selected>1 Month</option>
                    <option value="365">1 Year</option>
                    <option value="9999">Lifetime</option>
                </select>
            </div>
            <button onclick="createLicense()">Generate License</button>
            <div id="licenseMessage"></div>
        </div>

        <!-- MANAGE USERS TAB -->
        <div id="manageUsers" class="tab-content">
            <h2>Manage Users</h2>
            <button onclick="loadUsers()" style="width: auto;">Refresh Users</button>
            <div id="usersList"></div>
        </div>

        <!-- MANAGE LICENSES TAB -->
        <div id="manageLicenses" class="tab-content">
            <h2>Manage License Keys</h2>
            <button onclick="loadLicenses()" style="width: auto;">Refresh Licenses</button>
            <div id="licensesList"></div>
        </div>
    </div>

    <script>
        // Global variables
        let API_KEY = '';
        let BIN_ID = '';

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Setup JSONBin.io API
        async function setupAPI() {
            API_KEY = document.getElementById('apiKey').value;
            
            if(!API_KEY) {
                showMessage('apiMessage', 'Please enter API Key', 'error');
                return;
            }

            // Create initial data structure
            const initialData = {
                users: [],
                licenses: []
            };

            try {
                const response = await fetch('https://api.jsonbin.io/v3/b', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY,
                        'X-Bin-Name': 'JoystAuthData'
                    },
                    body: JSON.stringify(initialData)
                });

                const data = await response.json();
                BIN_ID = data.metadata.id;
                document.getElementById('binId').value = BIN_ID;
                
                showMessage('apiMessage', 'Database initialized successfully!', 'success');
                localStorage.setItem('joyst_api_key', API_KEY);
                localStorage.setItem('joyst_bin_id', BIN_ID);
            } catch (error) {
                showMessage('apiMessage', 'Error setting up database: ' + error, 'error');
            }
        }

        // Load data from JSONBin
        async function loadData() {
            if(!BIN_ID) BIN_ID = localStorage.getItem('joyst_bin_id');
            if(!API_KEY) API_KEY = localStorage.getItem('joyst_api_key');

            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: {
                        'X-Master-Key': API_KEY
                    }
                });
                return await response.json();
            } catch (error) {
                console.error('Error loading data:', error);
                return { record: { users: [], licenses: [] } };
            }
        }

        // Save data to JSONBin
        async function saveData(data) {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY
                    },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Create User
        async function createUser() {
            if(!API_KEY || !BIN_ID) {
                showMessage('userMessage', 'Please setup API first', 'error');
                return;
            }

            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const subscription = document.getElementById('userSubscription').value;

            if(!username || !password) {
                showMessage('userMessage', 'Please fill all fields', 'error');
                return;
            }

            const data = await loadData();
            const users = data.record.users;

            // Check if user exists
            if(users.find(u => u.username === username)) {
                showMessage('userMessage', 'Username already exists', 'error');
                return;
            }

            const userData = {
                username: username,
                password: password,
                subscription: subscription,
                expiry: Date.now() + (30 * 24 * 60 * 60 * 1000),
                hwid: null,
                status: 'active',
                created: Date.now()
            };

            users.push(userData);
            await saveData({ ...data.record, users: users });

            showMessage('userMessage', 'User created successfully!', 'success');
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
        }

        // Create License
        async function createLicense() {
            if(!API_KEY || !BIN_ID) {
                showMessage('licenseMessage', 'Please setup API first', 'error');
                return;
            }

            const licenseKey = document.getElementById('licenseKey').value;
            const subscription = document.getElementById('licenseSubscription').value;
            const duration = document.getElementById('licenseDuration').value;

            if(!licenseKey) {
                showMessage('licenseMessage', 'Please enter license key', 'error');
                return;
            }

            const data = await loadData();
            const licenses = data.record.licenses;

            if(licenses.find(l => l.key === licenseKey)) {
                showMessage('licenseMessage', 'License key already exists', 'error');
                return;
            }

            const licenseData = {
                key: licenseKey,
                subscription: subscription,
                duration: parseInt(duration),
                used: false,
                usedBy: null,
                usedAt: null,
                created: Date.now()
            };

            licenses.push(licenseData);
            await saveData({ ...data.record, licenses: licenses });

            showMessage('licenseMessage', 'License key generated successfully!', 'success');
            document.getElementById('licenseKey').value = '';
        }

        // Load Users
        async function loadUsers() {
            if(!API_KEY || !BIN_ID) {
                alert('Please setup API first');
                return;
            }

            const data = await loadData();
            const users = data.record.users;
            const usersList = document.getElementById('usersList');
            
            usersList.innerHTML = '';
            users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                userCard.innerHTML = `
                    <strong>${user.username}</strong>
                    <br>Password: ${user.password}
                    <br>Subscription: ${user.subscription}
                    <br>Expiry: ${new Date(user.expiry).toLocaleDateString()}
                    <br>HWID: ${user.hwid || 'Not set'}
                    <br>Status: ${user.status}
                    <br>
                    <button onclick="resetHWID('${user.username}')" style="width: auto; margin: 5px;">Reset HWID</button>
                    <button onclick="banUser('${user.username}')" style="width: auto; margin: 5px;">${user.status === 'banned' ? 'Unban' : 'Ban'}</button>
                    <button onclick="deleteUser('${user.username}')" style="width: auto; margin: 5px;">Delete</button>
                `;
                usersList.appendChild(userCard);
            });
        }

        // Load Licenses
        async function loadLicenses() {
            if(!API_KEY || !BIN_ID) {
                alert('Please setup API first');
                return;
            }

            const data = await loadData();
            const licenses = data.record.licenses;
            const licensesList = document.getElementById('licensesList');
            
            licensesList.innerHTML = '';
            licenses.forEach(license => {
                const licenseCard = document.createElement('div');
                licenseCard.className = 'license-card';
                licenseCard.innerHTML = `
                    <strong>${license.key}</strong>
                    <br>Type: ${license.subscription}
                    <br>Duration: ${license.duration} days
                    <br>Status: ${license.used ? 'USED by ' + license.usedBy : 'AVAILABLE'}
                    <br>Created: ${new Date(license.created).toLocaleDateString()}
                    <br>
                    <button onclick="deleteLicense('${license.key}')" style="width: auto; margin: 5px;">Delete</button>
                `;
                licensesList.appendChild(licenseCard);
            });
        }

        // User Management Functions
        async function resetHWID(username) {
            const data = await loadData();
            const users = data.record.users.map(user => {
                if(user.username === username) {
                    user.hwid = null;
                }
                return user;
            });
            await saveData({ ...data.record, users: users });
            loadUsers();
            alert('HWID reset for ' + username);
        }

        async function banUser(username) {
            const data = await loadData();
            const users = data.record.users.map(user => {
                if(user.username === username) {
                    user.status = user.status === 'banned' ? 'active' : 'banned';
                }
                return user;
            });
            await saveData({ ...data.record, users: users });
            loadUsers();
        }

        async function deleteUser(username) {
            const data = await loadData();
            const users = data.record.users.filter(user => user.username !== username);
            await saveData({ ...data.record, users: users });
            loadUsers();
        }

        async function deleteLicense(key) {
            const data = await loadData();
            const licenses = data.record.licenses.filter(license => license.key !== key);
            await saveData({ ...data.record, licenses: licenses });
            loadLicenses();
        }

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `message ${type}`;
            setTimeout(() => {
                element.innerHTML = '';
                element.className = '';
            }, 3000);
        }

        // Auto-generate license key
        document.getElementById('licenseKey').addEventListener('focus', function() {
            if(!this.value) {
                this.value = 'JOYST-' + Math.random().toString(36).substr(2, 8).toUpperCase();
            }
        });

        // Load saved API settings
        window.onload = function() {
            const savedKey = localStorage.getItem('joyst_api_key');
            const savedBin = localStorage.getItem('joyst_bin_id');
            
            if(savedKey) document.getElementById('apiKey').value = savedKey;
            if(savedBin) document.getElementById('binId').value = savedBin;
        };
    </script>
</body>
</html>
